---
title: "Milestone 5"
author: "Daniel Shapiro"
date: "3/5/2020"
output: pdf_document
bibliography: bib.bib
link_citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(stargazer)
library(multiwayvcov)
library(lmtest)
library(bookdown)
```

# Paper Overview

This paper [@paper] by Egor Lazarev entitled "Laws In Conflict: Legacies of War, Gender, and Legal Pluralism in Chechnya" examines post-war Chechnya and how legacies of war affect people's choice between various legal processes. In modern-day Chechnya, there are three competing legal bodies: official Russian law, sharia courts [@sharia], and customary law (adat) [@adat]. The author argues that sharia and adat courts are traditionally more discriminatory towards women, and that women are more likely than men to turn to state courts rather than sharia courts or adat. The pattern of women choosing to turn to state courts for legal disputes rather than sharia or customary courts is exacerbated, as the author works to show through data, by the level to which a region was affected by violence during the Chechen wars [@wars]. In other words, conflict provided women with more opportunity to pursue their interests through official law. The author, Egor Lazarev, backs up his claim through data and through a comparison with neighboring Ingushetia, which has many similarities but has not gone through conflict. The enhanced opportunities for women in the legal process has been counterbalanced by an effort by the Ramzan Kadyrov government in Chechnya to retraditionalize the republic [@retraditionalize], and while women continue to look to state courts for assistance, Kadyrov works toward supporting more traditional forms of conflict resolution that favor men and Chechnya's traditionally patriarchal society. The author concludes that gender can play a large role in forming splits in post-conflict societies.^[All analysis for this paper is available under Milestone-3.Rmd in my github repo: https://github.com/dfshapir/Replication]

Lazarev uses data throughout his paper to support his claims. The primary method he uses is ordinary least squares regression, in which Lazarev tests a number of different independent variables, including gender, exposure to conflict, distance from Chechnya’s capital (Groznyy), altitude (given cultural differences between upland and lowland Chechens [@mountain]) and various other variables on three indexes, which he labels indexRL, indexS and indexA. IndexRL, created by Lazarev early in the paper based on interview data, measures a given person’s likelihood to opt for Russian law, which indexS and indexA measure likelihood of sharia and adat, respectively. The author includes a number of graphics as well, including several ggplots, regression tables (created through stargazer) and others. Lazarev uses all of these methods to elucidate patterns in the data and arrive at his previously-described conclusions.

# Graphic

In this graphic, I use Lazarev's data to show gender-based trends in choice of legal structure in Chechnya. Lazarev makes a very similar graph in his paper; however, I made sure to format mine in a more "beautiful" manner. The graph shows how men and women differ in their respective likelihoods to choose Russian state law, sharia, and adat. The error bars are included as well to show the uncertainty around the means. 

```{r graphic, message = FALSE, warning = FALSE}
# I commented out this whole code in my Milestone-3.Rmd in the Figure 3 section. I made a few changes for the purposes of this assignment, which I have indicated in this code chunk. 

fig3dat <- read.csv2("raw-data/upd_wp_data_survey.csv")

range01 <- function(x) {(x - min(x))/(max(x) - min(x))}

require(plyr)
length2 <- function (x, na.rm=FALSE) {
  if (na.rm) sum(!is.na(x))
  else       length(x)
}

if (!require(pacman)) install.packages("pacman")

pacman::p_load(readr, ggplot2, plyr, dplyr, magrittr, tidyr, purrr, ggthemes)

means1 <- round(tapply(fig3dat$indexRL, fig3dat$female, mean, na.rm = T), digits=3)
sds1 <- round(tapply(fig3dat$indexRL, fig3dat$female, sd, na.rm = T), digits=3)
n1 <- tapply(fig3dat$indexRL, fig3dat$female, length2, na.rm = T)

se1 <- round(sds1/sqrt(n1), digits=3)

error1 <- round((qt(0.975,df=n1-1)*se1), digits = 3)

min <- c(0,1)
object1 <- c(1,1)

means2 <- round(tapply(fig3dat$indexS, fig3dat$female, mean, na.rm = T), digits=3)
sds2 <- round(tapply(fig3dat$indexS, fig3dat$female, sd, na.rm = T), digits=3)
n2 <- tapply(fig3dat$indexS, fig3dat$female, length2, na.rm = T)
se2 <- round(sds2/sqrt(n2), digits=3)
error2 <- round((qt(0.975,df=n2-1)*se2), digits = 3)
object2 <- c(2,2)

means3 <- round(tapply(fig3dat$indexA, fig3dat$female, mean, na.rm = T), digits=3)
sds3 <- round(tapply(fig3dat$indexA, fig3dat$female, sd, na.rm = T), digits=3)
n3 <- tapply(fig3dat$indexA, fig3dat$female, length2, na.rm = T)
se3 <- round(sds3/sqrt(n3), digits=3)
error3 <- round((qt(0.975,df=n3-1)*se3), digits = 3)
object3 <- c(3,3)

V1_dat <- rbind(cbind(object1, min, means1, sds1, n1, se1, error1, deparse.level=0),
                cbind(object2, min, means2, sds2, n2, se2, error2, deparse.level=0),
                cbind(object3, min, means3, sds3, n3, se3, error3, deparse.level=0))

rownames(V1_dat) <- c(1:6) 
colnames(V1_dat) <- c("sum", "min", "put", "sds", "n", "se", "error") 
sb <- as.data.frame(V1_dat)

sb2 <- sb

sb2$min <- as.factor(sb2$min) 
sb2$sum <- as.factor(sb2$sum)
levels(sb2$sum) <- c("State Law", "Sharia", "Adat") 

figure3 <- ggplot(sb2, aes(x=sum, y=put, fill = min)) + 
  geom_bar(position=position_dodge(), 
           stat="identity", size=.3) + 
  geom_errorbar(aes(ymin=put-error, ymax=put+error),
                size=.5,    
                width=.3,
                position=position_dodge(.9)) +
  
# Added titles and axis labels, changed to labs() instead of xlab(), ylab() and ggtitle()
  
  labs(title = "How Gender Impacts Choice of Legal System",
       subtitle = "Data From Lazarev, 'Laws in Conflict: Legacies of War, Gender, and Legal Pluralism in Chechnya'",
       x = "Legal System",
       y = "Mean of Index",
       caption = "Data from surveys performed by Lazarev during fieldwork. Indexes are calculated by averaging the number \nof scenarios where participants respond that they would choose one form of law over another.") +
  coord_cartesian(ylim=c(0, .5))+  
  scale_y_continuous(breaks=seq(0, 0.5, .1)) +
  scale_fill_manual(name="Gender", 
                    breaks=c("0", "1"), 
                    labels=c("Male", 
                             "Female"),
                    
# Capitalized legend labels

                    values=c("cornsilk3", "gray33")) +
  theme(text = element_text(size = 10),
        
# Changed text size
        
  axis.line = element_line(colour = "black"),

# Kept axis title

        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank())

figure3
```
\pagebreak

# Appendix

Below, I used Lazarev's code to replicate a table from his paper. He labels it originally as Table 3 in his code; in the paper, it is labeled as Table 4.

```{r include = FALSE}
reg_data <- read.csv2("raw-data/wp_data_courts.csv")

# I changed the name of the data from his original. I also put include = FALSE so that this all would not show up in the PDF, but I could make a table out of it. 

famdata <- reg_data[which(reg_data$family==1),]
nonfamdata <- reg_data[which(reg_data$family==0),]

m1 <- glm(istez_females ~ com_exposure + urban +
            mountainous + russ_pop + pop_fem_share + 
            as.factor(year),family=binomial(link='logit'),data = reg_data)
summary(m1)

m1_vcov <- cluster.vcov(m1, reg_data$uchastok)

coeftest(m1, vcov. = m1_vcov)

cluster_se <- sqrt(diag(cluster.vcov(m1, reg_data$uchastok)))

stargazer(m1, se = list(coeftest(m1, vcov. = m1_vcov)[,2]), 
          omit.stat = c("rsq", "f", "adj.rsq", "ser"))

m2 <- glm(istez_females ~ com_exposure + urban +
            mountainous + russ_pop + pop_fem_share + 
            as.factor(year),family=binomial(link='logit'),data=famdata)
summary(m2)

m2_vcov <- cluster.vcov(m2, famdata$uchastok)

coeftest(m2, vcov. = m2_vcov)

cluster_se <- sqrt(diag(cluster.vcov(m2, famdata$uchastok)))

m3 <- glm(istez_females ~ com_exposure + urban +
            mountainous + russ_pop + pop_fem_share + 
            as.factor(year),family=binomial(link='logit'),data=nonfamdata)
summary(m3)

m3_vcov <- cluster.vcov(m3, nonfamdata$uchastok)

coeftest(m3, vcov. = m3_vcov)

cluster_se <- sqrt(diag(cluster.vcov(m3, nonfamdata$uchastok)))
```

```{r results = "asis"}
stargazer(m1, m2, m3, se = list(coeftest(m1, vcov. = m1_vcov)[,2],
                                coeftest(m2, vcov. = m2_vcov)[,2],
                                coeftest(m3, vcov. = m3_vcov)[,2]),
          type="latex", 
          header = FALSE)
```

\pagebreak

Above is a screenshot of the actual table in Lazarev's paper. There are some differences in formatting, but all of the numbers that I got match the numbers in the table. Lazarev removes all of the coefficients for individual years and simply puts "yes" for "Year fixed effects" in every column. Also, Lazarev cleans up some of his variable names for purposes of readability. The numbers, however, check out.

```{r image, fig.cap = "Lazarev Image", out.width = '100%'}
knitr::include_graphics("lazarev_m5_screenshot.png")
```

# References