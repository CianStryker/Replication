---
title: "Milestone 4"
author: "Daniel Shapiro"
date: "2/26/2020"
output: pdf_document
# I saw Preceptor's recommendation to use the pdf_document2 class, but I just went for the classic PDF -- it looked nicer to me.
bibliography: bib.bib
link_citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tinytex)
library(bookdown)
library(gt)
library(tidyverse)
library(stargazer)
library(multiwayvcov)
library(lmtest)

# Loaded the packages that Preceptor suggested.
```

This paper [@paper] by Egor Lazarev entitled "Laws In Conflict: Legacies of War, Gender, and Legal Pluralism in Chechnya" examines post-war Chechnya and how legacies of war affect people's choice between various legal processes. In modern-day Chechnya, there are three competing legal bodies: official Russian law, sharia courts, and customary law (adat). The author argues that sharia and adat courts are traditionally more discriminatory towards women, and that women are more likely than men to turn to state courts rather than sharia courts or adat. The pattern of women choosing to turn to state courts for legal disputes rather than sharia or customary courts is exacerbated, as the author works to show through data, by the level to which a region was affected by violence during the Chechen wars. In other words, conflict provided women with more opportunity to pursue their interests through official law. The author, Egor Lazarev, backs up his claim through data and through a comparison with neighboring Ingushetia, which has many similarities but has not gone through conflict. The enhanced opportunities for women in the legal process has been counterbalanced by an effort by the Ramzan Kadyrov government in Chechnya to retraditionalize the republic [@retraditionalize], and while women continue to look to state courts for assistance, Kadyrov works toward supporting more traditional forms of conflict resolution that favor men and Chechnya's traditionally patriarchal society. The author concludes that gender can play a large role in forming splits in postconflict societies.^[Link to github repo: https://github.com/dfshapir/Replication]

## GT Table:

```{r gt}
gtdata <- read.csv2("raw-data/wp_data_raw.csv")

gtdata$rayon <- recode(gtdata$rayon, `achkhoy-martan` = "Achkhoy-Martan",
                       `argun` = "Argun",
                       `groznenskiy` = "Groznenskiy",
                       `gudermes` = "Gudermes",
                       `itum_kali` = "Itum-Kali",
                       `kurchaloi` = "Kurchaloi",
                       `nadterechnyi` = "Nadterechnyi",
                       `naursky` = "Naursky",
                       `shali` = "Shali",
                       `shatoi` = "Shatoi",
                       `subzhenskiy` = "Sunzhenskiy",
                       `urus-martan` = "Urus-Martan",
                       `vedeno` = "Vedeno")

# I recoded the names of the rayons (regions/counties) because he spelled a couple of them wrong, and I'd prefer for them to be capitalized in the table.

gttable <- gtdata %>%
  select(edu, age, ldistance_Grozny, rayon) %>%
  na.omit() %>%
  group_by(rayon) %>%
  summarize_at(.vars = vars(edu, age, ldistance_Grozny),
               .funs = c(mean="mean")) %>%
  rename(Region = "rayon",
         `Mean Education Index` = "edu_mean",
         `Mean Age` = "age_mean",
         `Mean Distance From Grozny (log)` = "ldistance_Grozny_mean") %>%

# I changed the names of the variables to be less technical and more user-friendly.
  
  gt() %>%
  tab_header(
    title = "Indicators By Region",
    subtitle = "Data From Egor Lazarev"
  ) %>%
  cols_align(align = "center", columns = TRUE)
```

```{r}
gttable

```

## Regression Table:

This table measures the effects of various variables, including community exposure to violence, urbanity, mountainous, size of Russian population, percent of women in the population and year, on the likelihood that a woman will be the plaintiff in a case.^[The word "istez" means plaintiff in Russian.] The data is split up into total cases (the first column), cases where the the case subject matter is a family issue (the second column), and cases where the case subject matter is not a family issue (third column). All data and code (with some tweaks, as indicated in my code comments) is from my replication article. 

```{r include = FALSE}
reg_data <- read.csv2("raw-data/wp_data_courts.csv")

# I changed the name of the data from his original. I also put include = FALSE so that this all would not show up in the PDF, but I could make a table out of it. 

famdata <- reg_data[which(reg_data$family==1),]
nonfamdata <- reg_data[which(reg_data$family==0),]

m1 <- glm(istez_females ~ com_exposure + urban +
            mountainous + russ_pop + pop_fem_share + 
            as.factor(year),family=binomial(link='logit'),data = reg_data)
summary(m1)

m1_vcov <- cluster.vcov(m1, reg_data$uchastok)

coeftest(m1, vcov. = m1_vcov)

cluster_se <- sqrt(diag(cluster.vcov(m1, reg_data$uchastok)))

stargazer(m1, se = list(coeftest(m1, vcov. = m1_vcov)[,2]), 
          omit.stat = c("rsq", "f", "adj.rsq", "ser"))

m2 <- glm(istez_females ~ com_exposure + urban +
            mountainous + russ_pop + pop_fem_share + 
            as.factor(year),family=binomial(link='logit'),data=famdata)
summary(m2)

m2_vcov <- cluster.vcov(m2, famdata$uchastok)

coeftest(m2, vcov. = m2_vcov)

cluster_se <- sqrt(diag(cluster.vcov(m2, famdata$uchastok)))

m3 <- glm(istez_females ~ com_exposure + urban +
            mountainous + russ_pop + pop_fem_share + 
            as.factor(year),family=binomial(link='logit'),data=nonfamdata)
summary(m3)

m3_vcov <- cluster.vcov(m3, nonfamdata$uchastok)

coeftest(m3, vcov. = m3_vcov)

cluster_se <- sqrt(diag(cluster.vcov(m3, nonfamdata$uchastok)))
```

```{r results = "asis"}
stargazer(m1, m2, m3, se = list(coeftest(m1, vcov. = m1_vcov)[,2],
                                coeftest(m2, vcov. = m2_vcov)[,2],
                                coeftest(m3, vcov. = m3_vcov)[,2]),
          type="latex", 
          header = FALSE)

# The only changes I really made here was the type (I used latex; he used html and then printed to a doc so that he could put it in his paper), and the fact that I put results = "asis" so that it would work in my document. Thanks to Cian for leading me to this trick. 
```

# References
